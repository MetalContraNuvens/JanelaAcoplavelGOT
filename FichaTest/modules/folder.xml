<?xml version="1.0" encoding="UTF-8"?>
<script>
	
	table.contains = function(table, val)
		for i=1,#table do
			if table[i] == val or table[i]:find(val) then 
				return true
			end
		end
		return false
	end;

	-- Concatena 2 arrays
	table.concatArray = function(array1, array2)
		local fusedArray = {};
		local n=0;
		for k,v in ipairs(array1) do n=n+1 ; fusedArray[n] = v end;
		for k,v in ipairs(array2) do n=n+1 ; fusedArray[n] = v end;
		return fusedArray;
	end;

	-- Split a string into a table using a delimiter and a limit
	string.split = function(str, pat, limit)
		local t = {}
		local fpat = "(.-)" .. pat
		local last_end = 1
		local s, e, cap = str:find(fpat, 1)
		while s do
			if s ~= 1 or cap ~= "" then
				table.insert(t, cap)
			end
			last_end = e+1
			s, e, cap = str:find(fpat, last_end)
			if limit ~= nil and #t > limit then
				break
			end
		end
		if #str > last_end then
			cap = str:sub(last_end)
			table.insert(t, cap)
		end
		return t
	end;

	-- Pega todas as pastas do rrpg
	function folderGetItens(internalCode)
		local minhaMesa = Firecast.getMesaDe(sheet);
		local folder = minhaMesa:findBibliotecaItem(internalCode);
		if not folder or not folder.filhos then
			return;
		end;
		local lista = {};
		lista[1] = {}; -- codigo interno
		lista[2] = {}; -- nome da ficha sem o codigo
		lista[3] = {}; -- informações da ficha

		for i = 1, #folder.filhos, 1 do
			if folder.filhos[i].tipo == "personagem" then
				local itemData = string.split(folder.filhos[i].nome, "|")
				if #itemData == 2 then
					table.insert(lista[1], folder.filhos[i].codigoInterno);
					table.insert(lista[2], itemData[1]);
					table.insert(lista[3], itemData[2]);
				end;
			end;
		end;
		return lista;
	end;

	-- Pega todas as pastas do rrpg
	function folderGetFolders(folder, parent)
		if not folder or not folder.filhos then
			local minhaMesa = Firecast.getMesaDe(sheet);
			return folderGetFolders(minhaMesa.biblioteca);
		end;
		local lista = {};
		lista[1] = {}; -- Nome
		lista[2] = {}; -- codigo interno
		for i = 1, #folder.filhos, 1 do
			local parentName = (parent or '') .. "/" .. folder.filhos[i].nome;
			if parentName:find('PCs') and folder.filhos[i].tipo == "personagem" then
				table.insert(lista[1], parentName);
				table.insert(lista[2], folder.filhos[i].codigoInterno);
			end;
			if parentName:find('PCs') and folder.filhos[i].tipo == "diretorio" then
				local subDiretorios = folderGetFolders(folder.filhos[i], parentName);
				lista[1] = table.concatArray(lista[1], subDiretorios[1]);
				lista[2] = table.concatArray(lista[2], subDiretorios[2]);
			end;
		end;
		return lista;
	end;

	function getFilhosItemBiBli(item)
		local filhos = {};

	end;

</script>